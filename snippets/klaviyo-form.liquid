<!-- snippets/klaviyo-form.liquid -->
{% comment %}
  Klaviyo Form Snippet
  Usage: {% render 'klaviyo-form', form_id: 'YOUR_FORM_ID' %}
{% endcomment %}

{% if form_id != blank %}
  <div class="klaviyo-form-container" id="klaviyo-form-{{ form_id }}">
    {% comment %} This will be populated by Klaviyo's JavaScript {% endcomment %}
    <div class="klaviyo-form-{{ form_id }}"></div>
  </div>

  <script type="text/javascript" async src="https://static.klaviyo.com/onsite/js/klaviyo.js?company_id={{ shop.permanent_domain | replace: '.myshopify.com', '' }}"></script>
  <script type="text/javascript">
    window.KlaviyoSubscribe = window.KlaviyoSubscribe || [];
    window.KlaviyoSubscribe.push(['identify', {
      '$email': ''
    }]);
    
    // Initialize the form
    if (typeof window._klOnsite !== 'undefined') {
      window._klOnsite.push(['display', '{{ form_id }}']);
    } else {
      window.addEventListener('load', function() {
        if (typeof window._klOnsite !== 'undefined') {
          window._klOnsite.push(['display', '{{ form_id }}']);
        }
      });
    }
  </script>

  <style>
    .klaviyo-form-container {
      width: 100%;
    }
    
    /* Minimal styling - let Klaviyo handle dimensions and layout */
    .klaviyo-form-{{ form_id }} {
      width: 100% !important;
      max-width: 100% !important;
      margin: 0 auto !important;
    }
    
    /* Ensure Klaviyo form inherits container styling */
    .klaviyo-form-{{ form_id }} .klaviyo-form-version-cid {
      width: 100% !important;
      max-width: none !important;
      height: auto !important;
    }
    
    /* Override only essential responsive behavior */
    .klaviyo-form-{{ form_id }} * {
      box-sizing: border-box !important;
    }
    
    /* Let Klaviyo handle form field sizing */
    .klaviyo-form-{{ form_id }} input,
    .klaviyo-form-{{ form_id }} button,
    .klaviyo-form-{{ form_id }} textarea {
      width: auto !important;
      max-width: 100% !important;
    }
    
    /* Ensure form is responsive within our container */
    @media (max-width: 749px) {
      .klaviyo-form-{{ form_id }} {
        width: 100% !important;
      }
    }
  </style>
{% endif %}