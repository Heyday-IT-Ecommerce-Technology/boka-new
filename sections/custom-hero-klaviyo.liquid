<!-- sections/custom-hero-klaviyo.liquid -->
<div class="custom-hero-section">
  <style>
    .custom-hero-section {
      position: relative;
      width: 100%;
      padding-top: {{ section.settings.padding_top }}px;
      padding-bottom: {{ section.settings.padding_bottom }}px;
    }
    
    .custom-hero-container {
      position: relative;
      width: 100%;
      overflow: hidden;
    }
    
    .media-container {
      position: relative;
      width: 100%;
      min-height: 50vh;
      max-height: 90vh;
      overflow: hidden;
      background-color: #f5f5f5;
    }
    
    .custom-hero-image,
    .custom-hero-video {
      width: 100%;
      height: 100%;
      min-height: 50vh;
      max-height: 90vh;
      display: block;
      object-fit: cover;
      object-position: center;
    }
    
    .custom-hero-image.mobile-only,
    .custom-hero-video.mobile-only {
      display: none;
    }
    
    /* Video specific styles */
    video.custom-hero-image {
      object-fit: cover;
      background-color: #000;
    }
    
    /* Responsive height adjustments */
    @media (min-width: 1920px) {
      .media-container,
      .custom-hero-image,
      .custom-hero-video {
        min-height: 60vh;
        max-height: 80vh;
      }
    }
    
    @media (max-width: 1440px) {
      .media-container,
      .custom-hero-image,
      .custom-hero-video {
        min-height: 45vh;
        max-height: 85vh;
      }
    }
    
    @media (max-width: 1024px) {
      .media-container,
      .custom-hero-image,
      .custom-hero-video {
        min-height: 40vh;
        max-height: 80vh;
      }
    }
    
    @media (max-width: 768px) {
      .media-container,
      .custom-hero-image,
      .custom-hero-video {
        min-height: 50vh;
        max-height: 70vh;
      }
    }
    
    @media (max-width: 480px) {
      .media-container,
      .custom-hero-image,
      .custom-hero-video {
        min-height: 45vh;
        max-height: 65vh;
      }
    }
    
    /* Ultra-wide screens */
    @media (min-width: 2560px) {
      .media-container,
      .custom-hero-image,
      .custom-hero-video {
        min-height: 50vh;
        max-height: 70vh;
      }
    }
    
    .custom-hero-content {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      padding: 2rem;
      border-radius: 12px;
      max-width: min(672px, 90vw);
      width: 90%;
      text-align: center;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);
      z-index: 10;
    }
    
    .custom-hero-content h2 {
      margin: 0 0 1rem 0;
      font-size: clamp(1.5rem, 4vw, 2.5rem);
      font-weight: bold;
      color: #333;
      line-height: 1.2;
    }
    
    {% comment %} .custom-hero-content p {
      margin: 0 0 1.5rem 0;
      color: #666;
      line-height: 1.5;
      font-size: clamp(0.9rem, 2.5vw, 1.1rem);
    } {% endcomment %}
    
    .klaviyo-form-wrapper {
      {% comment %} margin-top: 1rem; {% endcomment %}
      width: 100%;
    }
    
    /* Let Klaviyo forms use their native dimensions */
    .klaviyo-form-wrapper * {
      max-width: 100%;
    }
    
    /* Desktop alignment options */
    .custom-hero-content.align-left {
      left: min(10%, 100px);
      transform: translateY(-50%);
    }
    
    .custom-hero-content.align-right {
      left: auto;
      right: min(10%, 100px);
      transform: translateY(-50%);
    }
    
    .custom-hero-content.align-center {
      left: 50%;
      transform: translate(-50%, -50%);
    }
    
    /* Mobile styles */
    @media (max-width: 749px) {
      .custom-hero-image.desktop-only,
      .custom-hero-video.desktop-only {
        display: none;
      }
      
      .custom-hero-image.mobile-only,
      .custom-hero-video.mobile-only {
        display: block;
      }
      
      .custom-hero-content,
      .custom-hero-content.align-left,
      .custom-hero-content.align-right,
      .custom-hero-content.align-center {
        position: static;
        transform: none;
        {% comment %} margin: -80px 1rem 2rem 1rem; {% endcomment %}
        background: rgba(255, 255, 255, 0.98);
        backdrop-filter: blur(10px);
        z-index: 2;
        left: auto;
        right: auto;
        max-width: none;
        width: calc(100% - 2rem);
        padding: 1.5rem;
        border-radius: 12px;
        box-shadow: 0 4px 24px rgba(0, 0, 0, 0.12);
        visibility: hidden;
      }
      
      .custom-hero-content h2 {
        font-size: clamp(1.25rem, 5vw, 1.75rem);
        margin-bottom: 0.75rem;
      }
      
      .custom-hero-content p span{
        font-size: 30px !important;
        {% comment %} margin-bottom: 1rem; {% endcomment %}
      }
    }
    
    /* Small mobile screens */
    @media (max-width: 390px) {
      .custom-hero-content,
      .custom-hero-content.align-left,
      .custom-hero-content.align-right,
      .custom-hero-content.align-center {
        {% comment %} margin: -60px 0.75rem 1.5rem 0.75rem; {% endcomment %}
        padding: 1.25rem;
        width: calc(100% - 1.5rem);
      }
    }
    
    /* Desktop positioning options - above image */
    .desktop-above-image .custom-hero-content {
      position: static;
      transform: none;
      margin: 0 auto 2rem auto;
      background: rgba(255, 255, 255, 0.98);
      backdrop-filter: blur(10px);
      max-width: min(600px, 90vw);
    }
    
    .desktop-above-image .custom-hero-content.align-left {
      margin: 0 auto 2rem 0;
      max-width: min(500px, 90vw);
    }
    
    .desktop-above-image .custom-hero-content.align-right {
      margin: 0 0 2rem auto;
      max-width: min(500px, 90vw);
    }
    
    .desktop-above-image .custom-hero-content.align-center {
      margin: 0 auto 2rem auto;
      max-width: min(500px, 90vw);
    }
    
    @media (max-width: 749px) {
      .desktop-above-image .custom-hero-content,
      .desktop-above-image .custom-hero-content.align-left,
      .desktop-above-image .custom-hero-content.align-right,
      .desktop-above-image .custom-hero-content.align-center {
        position: static;
        transform: none;
        margin: 1rem;
        background: rgba(255, 255, 255, 0.98);
        backdrop-filter: blur(10px);
        max-width: none;
        width: calc(100% - 2rem);
      }
    }
    
    /* Container for above image positioning on desktop */
    .page-width {
      max-width: min(120rem, 95vw);
      margin: 0 auto;
      padding: 0 max(1.5rem, 2vw);
    }
    
    @media (max-width: 749px) {
      .page-width {
        padding: 0 1rem;
        max-width: 100vw;
      }
    }
    
    @media (max-width: 390px) {
      .page-width {
        padding: 0 0.75rem;
      }
    }
  </style>

  <div class="custom-hero-container {% if section.settings.desktop_content_position == 'above' %}desktop-above-image{% endif %}">
    
    {% comment %} Desktop content above image {% endcomment %}
    {% if section.settings.desktop_content_position == 'above' %}
      <div class="page-width">
        <div class="custom-hero-content desktop-only align-{{ section.settings.desktop_alignment }}" style="position: static; transform: none;">
          {% if section.settings.heading != blank %}
            <h2>{{ section.settings.heading }}</h2>
          {% endif %}
          {% if section.settings.description != blank %}
            <p>{{ section.settings.description }}</p>
          {% endif %}
          
          {% comment %} Klaviyo Form Integration {% endcomment %}
          {% if section.settings.klaviyo_form_id != blank %}
            <div class="klaviyo-form-wrapper">
              {% render 'klaviyo-form', form_id: section.settings.klaviyo_form_id %}
            </div>
          {% elsif section.settings.custom_embed_code != blank %}
            <div class="klaviyo-form-wrapper">
              {{ section.settings.custom_embed_code }}
            </div>
          {% endif %}
        </div>
      </div>
    {% endif %}

    {% comment %} Media Container (Images, GIFs, Videos) {% endcomment %}
    <div class="media-container">
      {% comment %} Desktop Media {% endcomment %}
      {% if section.settings.desktop_media_type == 'image' and section.settings.desktop_image != blank %}
        <img 
          src="{{ section.settings.desktop_image | image_url: width: 1920 }}"
          alt="{{ section.settings.desktop_image.alt | escape }}"
          class="custom-hero-image desktop-only"
          loading="lazy"
          width="{{ section.settings.desktop_image.width }}"
          height="{{ section.settings.desktop_image.height }}"
        >
      {% elsif section.settings.desktop_media_type == 'gif' and section.settings.desktop_gif != blank %}
        <img 
          src="{{ section.settings.desktop_gif | image_url: width: 1920 }}"
          alt="{{ section.settings.desktop_gif.alt | escape }}"
          class="custom-hero-image desktop-only"
          loading="lazy"
          width="{{ section.settings.desktop_gif.width }}"
          height="{{ section.settings.desktop_gif.height }}"
        >
      {% elsif section.settings.desktop_media_type == 'video' and section.settings.desktop_video != blank %}
        <video 
          class="custom-hero-image desktop-only"
          autoplay 
          muted 
          loop 
          playsinline
          {% if section.settings.video_poster != blank %}
            poster="{{ section.settings.video_poster | image_url: width: 1920 }}"
          {% endif %}
        >
          <source src="{{ section.settings.desktop_video }}" type="video/mp4">
          Your browser does not support the video tag.
        </video>
      {% endif %}
      
      {% comment %} Mobile Media {% endcomment %}
      {% if section.settings.mobile_media_type == 'image' and section.settings.mobile_image != blank %}
        <img 
          src="{{ section.settings.mobile_image | image_url: width: 750 }}"
          alt="{{ section.settings.mobile_image.alt | escape }}"
          class="custom-hero-image mobile-only"
          loading="lazy"
          width="{{ section.settings.mobile_image.width }}"
          height="{{ section.settings.mobile_image.height }}"
        >
      {% elsif section.settings.mobile_media_type == 'gif' and section.settings.mobile_gif != blank %}
        <img 
          src="{{ section.settings.mobile_gif | image_url: width: 750 }}"
          alt="{{ section.settings.mobile_gif.alt | escape }}"
          class="custom-hero-image mobile-only"
          loading="lazy"
          width="{{ section.settings.mobile_gif.width }}"
          height="{{ section.settings.mobile_gif.height }}"
        >
      {% elsif section.settings.mobile_media_type == 'video' and section.settings.mobile_video != blank %}
        <video 
          class="custom-hero-image mobile-only"
          autoplay 
          muted 
          loop 
          playsinline
          {% if section.settings.mobile_video_poster != blank %}
            poster="{{ section.settings.mobile_video_poster | image_url: width: 750 }}"
          {% endif %}
        >
          <source src="{{ section.settings.mobile_video }}" type="video/mp4">
          Your browser does not support the video tag.
        </video>
      {% elsif section.settings.desktop_media_type == 'image' and section.settings.desktop_image != blank %}
        {% comment %} Fallback to desktop image if mobile media not set {% endcomment %}
        <img 
          src="{{ section.settings.desktop_image | image_url: width: 750 }}"
          alt="{{ section.settings.desktop_image.alt | escape }}"
          class="custom-hero-image mobile-only"
          loading="lazy"
          width="{{ section.settings.desktop_image.width }}"
          height="{{ section.settings.desktop_image.height }}"
        >
      {% elsif section.settings.desktop_media_type == 'gif' and section.settings.desktop_gif != blank %}
        {% comment %} Fallback to desktop GIF if mobile media not set {% endcomment %}
        <img 
          src="{{ section.settings.desktop_gif | image_url: width: 750 }}"
          alt="{{ section.settings.desktop_gif.alt | escape }}"
          class="custom-hero-image mobile-only"
          loading="lazy"
          width="{{ section.settings.desktop_gif.width }}"
          height="{{ section.settings.desktop_gif.height }}"
        >
      {% elsif section.settings.desktop_media_type == 'video' and section.settings.desktop_video != blank %}
        {% comment %} Fallback to desktop video if mobile media not set {% endcomment %}
        <video 
          class="custom-hero-image mobile-only"
          autoplay 
          muted 
          loop 
          playsinline
          {% if section.settings.video_poster != blank %}
            poster="{{ section.settings.video_poster | image_url: width: 750 }}"
          {% endif %}
        >
          <source src="{{ section.settings.desktop_video }}" type="video/mp4">
          Your browser does not support the video tag.
        </video>
      {% endif %}
    </div>

    {% comment %} Content overlay for desktop or below image for mobile {% endcomment %}
    {% if section.settings.desktop_content_position == 'overlay' or section.settings.desktop_content_position == blank %}
      <div class="custom-hero-content align-{{ section.settings.desktop_alignment }}">
        {% if section.settings.heading != blank %}
          <h2>{{ section.settings.heading }}</h2>
        {% endif %}
        {% if section.settings.description != blank %}
          <p>{{ section.settings.description }}</p>
        {% endif %}
        
        {% comment %} Klaviyo Form Integration {% endcomment %}
        {% if section.settings.klaviyo_form_id != blank %}
          <div class="klaviyo-form-wrapper">
            {% render 'klaviyo-form', form_id: section.settings.klaviyo_form_id %}
          </div>
        {% elsif section.settings.custom_embed_code != blank %}
          <div class="klaviyo-form-wrapper">
            {{ section.settings.custom_embed_code }}
          </div>
        {% endif %}
      </div>
    {% endif %}

    {% comment %} Mobile content below image when desktop is above {% endcomment %}
    {% if section.settings.desktop_content_position == 'above' %}
      <div class="custom-hero-content mobile-only" style="position: static; transform: none; margin: 1rem; background: rgba(255, 255, 255, 0.98); display: none;">
        {% if section.settings.heading != blank %}
          <h2>{{ section.settings.heading }}</h2>
        {% endif %}
        {% if section.settings.description != blank %}
          <p>{{ section.settings.description }}</p>
        {% endif %}
        
        {% comment %} Klaviyo Form Integration for Mobile {% endcomment %}
        {% if section.settings.klaviyo_form_id != blank %}
          <div class="klaviyo-form-wrapper">
            {% render 'klaviyo-form', form_id: section.settings.klaviyo_form_id %}
          </div>
        {% elsif section.settings.custom_embed_code != blank %}
          <div class="klaviyo-form-wrapper">
            {{ section.settings.custom_embed_code }}
          </div>
        {% endif %}
      </div>
      
      <style>
        @media (max-width: 749px) {
          .custom-hero-content.mobile-only {
            display: block !important;
          }
        }
      </style>
    {% endif %}

  </div>
</div>

{% comment %} Klaviyo App Block Areas {% endcomment %}
{% for block in section.blocks %}
  {% case block.type %}
    {% when 'klaviyo_form' %}
      <div {{ block.shopify_attributes }} style="display: none;">
        {% comment %} This is handled via the Klaviyo app embed {% endcomment %}
      </div>
  {% endcase %}
{% endfor %}

{% schema %}
{
  "name": "Custom Hero with Klaviyo",
  "tag": "section",
  "class": "section",
  "settings": [
    {
      "type": "header",
      "content": "Desktop Media"
    },
    {
      "type": "select",
      "id": "desktop_media_type",
      "label": "Desktop Media Type",
      "options": [
        {
          "value": "image",
          "label": "Image"
        },
        {
          "value": "gif",
          "label": "GIF"
        },
        {
          "value": "video",
          "label": "Video"
        }
      ],
      "default": "image"
    },
    {
      "type": "image_picker",
      "id": "desktop_image",
      "label": "Desktop Image",
      "info": "Recommended size: 1920x800px"
    },
    {
      "type": "image_picker",
      "id": "desktop_gif",
      "label": "Desktop GIF",
      "info": "Upload your GIF file. Recommended size: 1920x800px"
    },
    {
      "type": "url",
      "id": "desktop_video",
      "label": "Desktop Video URL",
      "info": "Direct link to MP4 video file (e.g., from Shopify Files or external hosting)"
    },
    {
      "type": "image_picker",
      "id": "video_poster",
      "label": "Desktop Video Poster Image",
      "info": "Thumbnail image shown before video loads"
    },
    {
      "type": "header",
      "content": "Mobile Media"
    },
    {
      "type": "select",
      "id": "mobile_media_type",
      "label": "Mobile Media Type",
      "options": [
        {
          "value": "image",
          "label": "Image"
        },
        {
          "value": "gif",
          "label": "GIF"
        },
        {
          "value": "video",
          "label": "Video"
        },
        {
          "value": "same",
          "label": "Use same as desktop"
        }
      ],
      "default": "same",
      "info": "Choose 'Use same as desktop' to automatically use desktop media on mobile"
    },
    {
      "type": "image_picker",
      "id": "mobile_image",
      "label": "Mobile Image",
      "info": "Recommended size: 750x1000px"
    },
    {
      "type": "image_picker",
      "id": "mobile_gif",
      "label": "Mobile GIF",
      "info": "Upload your mobile GIF file. Recommended size: 750x1000px"
    },
    {
      "type": "url",
      "id": "mobile_video",
      "label": "Mobile Video URL",
      "info": "Direct link to MP4 video file optimized for mobile"
    },
    {
      "type": "image_picker",
      "id": "mobile_video_poster",
      "label": "Mobile Video Poster Image",
      "info": "Thumbnail image shown before mobile video loads"
    },
    {
      "type": "header",
      "content": "Content"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Something's Blooming"
    },
    {
      "type": "textarea",
      "id": "description",
      "label": "Description",
      "default": "A revolutionary oral care upgrade is coming on Sept 9. Get ready for the big reveal! Sign up to stay in the loop."
    },
    {
      "type": "select",
      "id": "desktop_content_position",
      "label": "Desktop Content Position",
      "options": [
        {
          "value": "overlay",
          "label": "Over Image (Overlay)"
        },
        {
          "value": "above",
          "label": "Above Image"
        }
      ],
      "default": "overlay",
      "info": "On mobile, content will always appear below the image"
    },
    {
      "type": "select",
      "id": "desktop_alignment",
      "label": "Desktop Content Alignment",
      "options": [
        {
          "value": "left",
          "label": "Left"
        },
        {
          "value": "center",
          "label": "Center"
        },
        {
          "value": "right",
          "label": "Right"
        }
      ],
      "default": "center",
      "info": "Content alignment on desktop. On mobile, content is always centered."
    },
    {
      "type": "header",
      "content": "Klaviyo Integration"
    },
    {
      "type": "paragraph",
      "content": "Choose one method below to add your Klaviyo form:"
    },
    {
      "type": "text",
      "id": "klaviyo_form_id",
      "label": "Klaviyo Form ID (Recommended)",
      "info": "Enter your Klaviyo form ID (e.g., ABC123). This uses the Klaviyo app block and preserves the original form dimensions and styling from Klaviyo. Make sure the Klaviyo app embed is enabled in your Shopify store."
    },
    {
      "type": "html",
      "id": "custom_embed_code",
      "label": "Custom Embed Code (Alternative)",
      "info": "If Form ID doesn't work, paste your complete Klaviyo embed code here as a fallback."
    },
    {
      "type": "header",
      "content": "Section Settings"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Top Padding",
      "default": 0
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Bottom Padding",
      "default": 0
    }
  ],
  "blocks": [
    {
      "type": "klaviyo_form",
      "name": "Klaviyo Form",
      "settings": [
        {
          "type": "text",
          "id": "form_id",
          "label": "Form ID",
          "info": "Klaviyo form ID"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Custom Hero with Klaviyo"
    }
  ]
}
{% endschema %}